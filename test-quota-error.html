<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API í• ë‹¹ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #000;
            color: #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #cce7ff; color: #004085; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .error-response {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ Gemini API í• ë‹¹ëŸ‰ ì´ˆê³¼ ì‘ë‹µ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="warning">
            <strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong><br>
            ì´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ API í• ë‹¹ëŸ‰ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
            í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë²ˆì˜ API í˜¸ì¶œì„ ì‹œë„í•©ë‹ˆë‹¤.
        </div>
        
        <button onclick="testQuotaExhaustion()">í• ë‹¹ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
        <button onclick="testSingleCall()">ë‹¨ì¼ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸</button>
        <button onclick="simulateQuotaError()">í• ë‹¹ëŸ‰ ì—ëŸ¬ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        
        <div id="status"></div>
        <div id="log" class="log"></div>
        
        <h3>ğŸ“‹ ì˜ˆìƒë˜ëŠ” í• ë‹¹ëŸ‰ ì´ˆê³¼ ì‘ë‹µ í˜•íƒœ</h3>
        <div class="error-response">
HTTP Status: 429 (Too Many Requests)
ë˜ëŠ”
HTTP Status: 403 (Forbidden)

ì‘ë‹µ ë³¸ë¬¸ ì˜ˆì‹œ:
{
  "error": {
    "code": 429,
    "message": "Quota exceeded for quota metric 'Generate requests' and limit 'Generate requests per minute per project' of service 'generativelanguage.googleapis.com' for consumer 'project_number:PROJECT_NUMBER'.",
    "status": "RESOURCE_EXHAUSTED"
  }
}

ë˜ëŠ”

{
  "error": {
    "code": 403,
    "message": "The request cannot be completed because you have exceeded your quota.",
    "status": "QUOTA_EXCEEDED"
  }
}</div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBY1aPCt5gkJr7m8BCuTRUjtLl5PWHO4Dg';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        let callCount = 0;
        let quotaErrorDetected = false;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('status').innerHTML = '';
            callCount = 0;
            quotaErrorDetected = false;
        }
        
        async function makeAPICall(callIndex) {
            const requestBody = {
                contents: [{
                    parts: [{
                        text: `í…ŒìŠ¤íŠ¸ í˜¸ì¶œ #${callIndex} - í˜„ì¬ ì‹œê°„: ${new Date().toISOString()}`
                    }]
                }],
                generationConfig: {
                    temperature: 0.1,
                    maxOutputTokens: 50
                }
            };
            
            log(`ğŸ”„ API í˜¸ì¶œ #${callIndex} ì‹œì‘...`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                log(`ğŸ“Š í˜¸ì¶œ #${callIndex} - ìƒíƒœ: ${response.status}, ì‹œê°„: ${responseTime}ms`);
                
                // ì‘ë‹µ í—¤ë” í™•ì¸
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                log(`ğŸ“‹ ì‘ë‹µ í—¤ë”: ${JSON.stringify(headers, null, 2)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… í˜¸ì¶œ #${callIndex} ì„±ê³µ`, 'success');
                    return { success: true, data, responseTime };
                } else {
                    // ì—ëŸ¬ ì‘ë‹µ ìƒì„¸ ë¶„ì„
                    const errorText = await response.text();
                    log(`âŒ í˜¸ì¶œ #${callIndex} ì‹¤íŒ¨ - ìƒíƒœ: ${response.status}`, 'error');
                    log(`ğŸ” ì—ëŸ¬ ì‘ë‹µ ì›ë³¸: ${errorText}`, 'error');
                    
                    // JSON íŒŒì‹± ì‹œë„
                    try {
                        const errorData = JSON.parse(errorText);
                        log(`ğŸ“‹ íŒŒì‹±ëœ ì—ëŸ¬ ë°ì´í„°: ${JSON.stringify(errorData, null, 2)}`, 'error');
                        
                        // í• ë‹¹ëŸ‰ ê´€ë ¨ ì—ëŸ¬ ì²´í¬
                        if (response.status === 429 || response.status === 403) {
                            if (errorData.error && (
                                errorData.error.message.includes('quota') || 
                                errorData.error.message.includes('Quota') ||
                                errorData.error.message.includes('limit') ||
                                errorData.error.status === 'RESOURCE_EXHAUSTED' ||
                                errorData.error.status === 'QUOTA_EXCEEDED'
                            )) {
                                log(`ğŸš¨ í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ê°ì§€! ğŸš¨`, 'error');
                                quotaErrorDetected = true;
                                return { 
                                    success: false, 
                                    isQuotaError: true, 
                                    status: response.status,
                                    errorData,
                                    responseTime 
                                };
                            }
                        }
                        
                        return { 
                            success: false, 
                            isQuotaError: false, 
                            status: response.status,
                            errorData,
                            responseTime 
                        };
                    } catch (parseError) {
                        log(`âŒ ì—ëŸ¬ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨: ${parseError.message}`, 'error');
                        return { 
                            success: false, 
                            isQuotaError: false, 
                            status: response.status,
                            errorText,
                            responseTime 
                        };
                    }
                }
            } catch (networkError) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ í˜¸ì¶œ #${callIndex}: ${networkError.message}`, 'error');
                return { success: false, networkError: networkError.message };
            }
        }
        
        async function testQuotaExhaustion() {
            log('=== ğŸš¨ í• ë‹¹ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸ ì‹œì‘ ğŸš¨ ===');
            setStatus('í• ë‹¹ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...', 'info');
            
            quotaErrorDetected = false;
            callCount = 0;
            const maxCalls = 20; // ìµœëŒ€ 20ë²ˆ í˜¸ì¶œ
            const delayBetweenCalls = 1000; // 1ì´ˆ ê°„ê²©
            
            log(`ğŸ“Š í…ŒìŠ¤íŠ¸ ê³„íš: ìµœëŒ€ ${maxCalls}ë²ˆ í˜¸ì¶œ, ${delayBetweenCalls}ms ê°„ê²©`);
            log(`âš ï¸ í• ë‹¹ëŸ‰ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤`);
            
            for (let i = 1; i <= maxCalls && !quotaErrorDetected; i++) {
                callCount = i;
                const result = await makeAPICall(i);
                
                if (result.isQuotaError) {
                    log(`ğŸ¯ í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ë°œê²¬! ${i}ë²ˆì§¸ í˜¸ì¶œì—ì„œ ë°œìƒ`, 'error');
                    log(`ğŸ“Š ì—ëŸ¬ ìƒíƒœ ì½”ë“œ: ${result.status}`, 'error');
                    log(`ğŸ“‹ ì—ëŸ¬ ìƒì„¸ ì •ë³´: ${JSON.stringify(result.errorData, null, 2)}`, 'error');
                    setStatus(`í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ë°œê²¬! (${i}ë²ˆì§¸ í˜¸ì¶œ)`, 'error');
                    break;
                } else if (!result.success && result.status === 429) {
                    log(`âš ï¸ 429 ì—ëŸ¬ ë°œìƒ - ìš”ì²­ í•œë„ ì´ˆê³¼ ê°€ëŠ¥ì„±`, 'warning');
                } else if (!result.success && result.status === 403) {
                    log(`âš ï¸ 403 ì—ëŸ¬ ë°œìƒ - ê¶Œí•œ ë˜ëŠ” í• ë‹¹ëŸ‰ ë¬¸ì œ ê°€ëŠ¥ì„±`, 'warning');
                }
                
                // ë‹¤ìŒ í˜¸ì¶œê¹Œì§€ ëŒ€ê¸°
                if (i < maxCalls && !quotaErrorDetected) {
                    log(`â±ï¸ ${delayBetweenCalls}ms ëŒ€ê¸° ì¤‘...`);
                    await new Promise(resolve => setTimeout(resolve, delayBetweenCalls));
                }
            }
            
            if (!quotaErrorDetected) {
                log(`âœ… ${maxCalls}ë²ˆ í˜¸ì¶œ ì™„ë£Œ - í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ì—†ìŒ`, 'success');
                setStatus(`${maxCalls}ë²ˆ í˜¸ì¶œ ì™„ë£Œ - í• ë‹¹ëŸ‰ ì—¬ìœ ë¶„ ìˆìŒ`, 'success');
            }
            
            log(`ğŸ“Š ì´ í˜¸ì¶œ íšŸìˆ˜: ${callCount}`);
        }
        
        async function testSingleCall() {
            log('=== ë‹¨ì¼ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ===');
            setStatus('ë‹¨ì¼ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            const result = await makeAPICall(1);
            
            if (result.success) {
                log('âœ… ë‹¨ì¼ í˜¸ì¶œ ì„±ê³µ', 'success');
                setStatus('API ì •ìƒ ì‘ë™', 'success');
            } else {
                log('âŒ ë‹¨ì¼ í˜¸ì¶œ ì‹¤íŒ¨', 'error');
                setStatus('API í˜¸ì¶œ ì‹¤íŒ¨', 'error');
            }
        }
        
        function simulateQuotaError() {
            log('=== í• ë‹¹ëŸ‰ ì—ëŸ¬ ì‹œë®¬ë ˆì´ì…˜ ===');
            
            // ê°€ëŠ¥í•œ í• ë‹¹ëŸ‰ ì—ëŸ¬ ì‘ë‹µë“¤
            const quotaErrors = [
                {
                    status: 429,
                    error: {
                        code: 429,
                        message: "Quota exceeded for quota metric 'Generate requests' and limit 'Generate requests per minute per project' of service 'generativelanguage.googleapis.com' for consumer 'project_number:123456789'.",
                        status: "RESOURCE_EXHAUSTED"
                    }
                },
                {
                    status: 403,
                    error: {
                        code: 403,
                        message: "The request cannot be completed because you have exceeded your quota.",
                        status: "QUOTA_EXCEEDED"
                    }
                },
                {
                    status: 429,
                    error: {
                        code: 429,
                        message: "Too many requests. Quota exceeded.",
                        status: "RESOURCE_EXHAUSTED",
                        details: [
                            {
                                "@type": "type.googleapis.com/google.rpc.ErrorInfo",
                                "reason": "RATE_LIMIT_EXCEEDED",
                                "domain": "googleapis.com",
                                "metadata": {
                                    "quota_metric": "generate_requests",
                                    "quota_limit": "requests_per_minute_per_project"
                                }
                            }
                        ]
                    }
                }
            ];
            
            quotaErrors.forEach((errorExample, index) => {
                log(`ğŸ“‹ í• ë‹¹ëŸ‰ ì—ëŸ¬ ì˜ˆì‹œ #${index + 1}:`);
                log(`ìƒíƒœ ì½”ë“œ: ${errorExample.status}`);
                log(`ì‘ë‹µ ë³¸ë¬¸: ${JSON.stringify(errorExample, null, 2)}`);
                log('---');
            });
            
            log('ğŸ“ í• ë‹¹ëŸ‰ ì—ëŸ¬ì˜ ì£¼ìš” íŠ¹ì§•:');
            log('- HTTP ìƒíƒœ ì½”ë“œ: 429 (Too Many Requests) ë˜ëŠ” 403 (Forbidden)');
            log('- error.status: "RESOURCE_EXHAUSTED" ë˜ëŠ” "QUOTA_EXCEEDED"');
            log('- error.message: "quota", "limit", "exceeded" ë“±ì˜ í‚¤ì›Œë“œ í¬í•¨');
            log('- ì¼ì‹œì  ì—ëŸ¬ë¡œ, ì‹œê°„ì´ ì§€ë‚˜ë©´ ë‹¤ì‹œ ì‚¬ìš© ê°€ëŠ¥');
            
            setStatus('í• ë‹¹ëŸ‰ ì—ëŸ¬ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ', 'info');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', function() {
            log('ğŸš€ Gemini API í• ë‹¹ëŸ‰ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ’¡ Gemini 1.5 Flash ë¬´ë£Œ í• ë‹¹ëŸ‰ ì •ë³´:');
            log('- í•˜ë£¨: 1,500 ìš”ì²­');
            log('- ë¶„ë‹¹: 15 ìš”ì²­');
            log('- í˜„ì¬ ì‹œê°„: ' + new Date().toLocaleString());
        });
    </script>
</body>
</html> 