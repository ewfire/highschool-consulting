<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #3367d6;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .log {
            max-height: 400px;
            overflow-y: auto;
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– Gemini API í…ŒìŠ¤íŠ¸</h1>
        
        <div class="info">
            <strong>API í‚¤:</strong> AIzaSyBY1aPCt5gkJr7m8BCuTRUjtLl5PWHO4Dg (ë§ˆì§€ë§‰ 4ìë¦¬: 4Dg)
        </div>
        
        <button onclick="testSimpleAPI()">ê°„ë‹¨í•œ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="testSajuAPI()">ì‚¬ì£¼ ë¶„ì„ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="showApiStats()">API í†µê³„ ë³´ê¸°</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        
        <div id="status"></div>
        
        <h3>ğŸ“‹ ì‹¤ì‹œê°„ ë¡œê·¸</h3>
        <div id="log" class="log"></div>
        
        <h3>ğŸ“Š API ì‘ë‹µ ê²°ê³¼</h3>
        <pre id="result"></pre>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBY1aPCt5gkJr7m8BCuTRUjtLl5PWHO4Dg';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        // API í˜¸ì¶œ ì¶”ì  ë³€ìˆ˜ë“¤
        let apiCallCount = 0;
        let apiCallHistory = [];
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('status').innerHTML = '';
            // API í˜¸ì¶œ ê¸°ë¡ì€ ìœ ì§€
            log(`ğŸ”„ ë¡œê·¸ ì´ˆê¸°í™” (ì´ API í˜¸ì¶œ íšŸìˆ˜: ${apiCallCount})`);
        }
        
        function trackApiCall(type, success, responseTime) {
            apiCallCount++;
            const callInfo = {
                id: apiCallCount,
                type: type,
                timestamp: new Date().toISOString(),
                success: success,
                responseTime: responseTime
            };
            apiCallHistory.push(callInfo);
            
            log(`ğŸ“Š API í˜¸ì¶œ #${apiCallCount} - ${type} - ${success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'} (${responseTime}ms)`);
            updateApiStats();
        }
        
        function updateApiStats() {
            const successCalls = apiCallHistory.filter(call => call.success).length;
            const failedCalls = apiCallHistory.filter(call => call.success === false).length;
            
            log(`ğŸ“ˆ í†µê³„: ì´ ${apiCallCount}íšŒ í˜¸ì¶œ (ì„±ê³µ: ${successCalls}, ì‹¤íŒ¨: ${failedCalls})`);
        }
        
        function showApiStats() {
            log('=== API í˜¸ì¶œ í†µê³„ ===');
            log(`ì´ API í˜¸ì¶œ íšŸìˆ˜: ${apiCallCount}`);
            
            if (apiCallHistory.length === 0) {
                log('ì•„ì§ API í˜¸ì¶œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const successCalls = apiCallHistory.filter(call => call.success).length;
            const failedCalls = apiCallHistory.filter(call => call.success === false).length;
            const avgResponseTime = apiCallHistory.reduce((sum, call) => sum + call.responseTime, 0) / apiCallHistory.length;
            
            log(`âœ… ì„±ê³µ: ${successCalls}íšŒ`);
            log(`âŒ ì‹¤íŒ¨: ${failedCalls}íšŒ`);
            log(`â±ï¸ í‰ê·  ì‘ë‹µ ì‹œê°„: ${Math.round(avgResponseTime)}ms`);
            
            log('=== ìµœê·¼ 5íšŒ í˜¸ì¶œ ê¸°ë¡ ===');
            const recentCalls = apiCallHistory.slice(-5);
            recentCalls.forEach(call => {
                const status = call.success ? 'âœ…' : 'âŒ';
                const time = new Date(call.timestamp).toLocaleTimeString();
                log(`${status} #${call.id} ${call.type} - ${time} (${call.responseTime}ms)`);
            });
        }
        
        async function testSimpleAPI() {
            log('=== ê°„ë‹¨í•œ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('API í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            // ë§¤ë²ˆ ë‹¤ë¥¸ ì§ˆë¬¸ì„ ìƒì„±
            const questions = [
                "ì•ˆë…•í•˜ì„¸ìš”! í˜„ì¬ ì‹œê°„ì„ ì•Œë ¤ì£¼ì„¸ìš”.",
                "ì˜¤ëŠ˜ì€ ëª‡ ë…„ ëª‡ ì›” ëª‡ ì¼ì¸ê°€ìš”?",
                "ì§€ê¸ˆ ëª‡ ì‹œì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”.",
                "í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì•Œë ¤ì£¼ì„¸ìš”.",
                "ì˜¤ëŠ˜ì˜ ìš”ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "í˜„ì¬ ì‹œê°ì„ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”."
            ];
            const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
            const timestamp = new Date().toISOString();
            const finalQuestion = `${randomQuestion} (ìš”ì²­ì‹œê°„: ${timestamp})`;
            
            log(`ì„ íƒëœ ì§ˆë¬¸: ${randomQuestion}`);
            log(`ìš”ì²­ íƒ€ì„ìŠ¤íƒ¬í”„: ${timestamp}`);
            
            try {
                log('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ' + (navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'));
                log('API í˜¸ì¶œ ì‹œì‘...');
                
                const startTime = Date.now();
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: finalQuestion
                            }]
                        }]
                    })
                });
                const endTime = Date.now();
                
                log(`ì‘ë‹µ ì‹œê°„: ${endTime - startTime}ms`);
                log(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`ì—ëŸ¬ ì‘ë‹µ: ${errorText}`, 'error');
                    setStatus(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`, 'error');
                    return;
                }
                
                const data = await response.json();
                log('API í˜¸ì¶œ ì„±ê³µ!', 'success');
                
                // API í˜¸ì¶œ ì¶”ì 
                trackApiCall('ê°„ë‹¨í•œ API', true, endTime - startTime);
                
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
                setStatus('âœ… API í˜¸ì¶œ ì„±ê³µ!', 'success');
                
            } catch (error) {
                log(`API í˜¸ì¶œ ì˜¤ë¥˜: ${error.message}`, 'error');
                setStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                document.getElementById('result').textContent = error.stack;
                
                // API í˜¸ì¶œ ì¶”ì  (ì‹¤íŒ¨)
                trackApiCall('ê°„ë‹¨í•œ API', false, Date.now() - startTime);
            }
        }
        
        async function testSajuAPI() {
            log('=== ì‚¬ì£¼ ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('ì‚¬ì£¼ ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            // ë§¤ë²ˆ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± (ë” ë‹¤ì–‘í•œ ì¡°í•©)
            const names = ['ê¹€í…ŒìŠ¤íŠ¸', 'ì´ìƒ˜í”Œ', 'ë°•ì˜ˆì‹œ', 'ìµœë°ëª¨', 'ì •ì‹¤í—˜', 'í•œë¯¼ìˆ˜', 'ìœ¤ì§€ì˜', 'ì¥í˜„ìš°'];
            const years = ['2005', '2006', '2007', '2008', '2009', '2010', '2011'];
            const months = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
            const days = ['1', '5', '10', '15', '20', '25', '28'];
            const times = ['ìì‹œ(23-01ì‹œ)', 'ì¶•ì‹œ(01-03ì‹œ)', 'ì¸ì‹œ(03-05ì‹œ)', 'ë¬˜ì‹œ(05-07ì‹œ)', 'ì§„ì‹œ(07-09ì‹œ)', 'ì‚¬ì‹œ(09-11ì‹œ)', 'ì˜¤ì‹œ(11-13ì‹œ)', 'ë¯¸ì‹œ(13-15ì‹œ)', 'ì‹ ì‹œ(15-17ì‹œ)', 'ìœ ì‹œ(17-19ì‹œ)', 'ìˆ ì‹œ(19-21ì‹œ)', 'í•´ì‹œ(21-23ì‹œ)'];
            const genders = ['ë‚¨ì„±', 'ì—¬ì„±'];
            
            const testUserData = {
                name: names[Math.floor(Math.random() * names.length)],
                birthYear: years[Math.floor(Math.random() * years.length)],
                birthMonth: months[Math.floor(Math.random() * months.length)],
                birthDay: days[Math.floor(Math.random() * days.length)],
                birthTime: times[Math.floor(Math.random() * times.length)],
                gender: genders[Math.floor(Math.random() * genders.length)]
            };
            
            const requestId = Math.random().toString(36).substr(2, 9);
            const uniquePromptVariation = Math.floor(Math.random() * 5) + 1; // 1-5 ì‚¬ì´ì˜ ìˆ«ì
            
            log(`ìš”ì²­ ID: ${requestId}`);
            log(`í”„ë¡¬í”„íŠ¸ ë³€í˜•: ${uniquePromptVariation}`);
            log('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë°ì´í„°: ' + JSON.stringify(testUserData));
            
            // ë” êµ¬ì²´ì ì´ê³  ë‹¤ì–‘í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±
            const specificPrompts = [
                `ë‹¹ì‹ ì€ 40ë…„ ê²½ë ¥ì˜ ì‚¬ì£¼ëª…ë¦¬í•™ ëŒ€ê°€ì…ë‹ˆë‹¤. ${testUserData.name}(${testUserData.birthYear}ë…„ ${testUserData.birthMonth}ì›” ${testUserData.birthDay}ì¼ ${testUserData.birthTime} ${testUserData.gender})ì˜ ì‚¬ì£¼ë¥¼ ì •ë°€ ë¶„ì„í•˜ì—¬ ê³ êµ ì§„í•™ì„ ì¡°ì–¸í•˜ì„¸ìš”. ì´ í•™ìƒì˜ íƒ€ê³ ë‚œ ì˜¤í–‰ ê¸°ì§ˆê³¼ ì‹­ì‹ (åç¥) ë°°ì¹˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•™ìŠµ ì„±í–¥ê³¼ ì ì„±ì„ íŒŒì•…í•˜ì—¬ ë§ì¶¤í˜• í•™êµë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.`,
                
                `ì „í†µ ì‚¬ì£¼í•™ì— ê¸°ë°˜í•´ ${testUserData.name} í•™ìƒì˜ ëª…ì¡°ë¥¼ ë¶„ì„í•˜ì„¸ìš”. ${testUserData.birthYear}ë…„ ${testUserData.birthMonth}ì›” ${testUserData.birthDay}ì¼ ${testUserData.birthTime} ì¶œìƒí•œ ${testUserData.gender}ì˜ ì¼ê°„ê³¼ ì›”ê°„ì˜ ê´€ê³„, ìš©ì‹ ê³¼ ê¸°ì‹ ì„ ê³ ë ¤í•˜ì—¬ ì´ í•™ìƒì—ê²Œ ê°€ì¥ ìœ ë¦¬í•œ í•™ìŠµ í™˜ê²½ê³¼ ì§„ë¡œ ë°©í–¥ì„ ì œì‹œí•˜ì„¸ìš”.`,
                
                `${testUserData.name}ì˜ ìƒë…„ì›”ì¼ì‹œ(${testUserData.birthYear}.${testUserData.birthMonth}.${testUserData.birthDay} ${testUserData.birthTime})ë¡œ ì‚¬ì£¼íŒ”ìë¥¼ êµ¬ì„±í•˜ì—¬ ë¶„ì„í•˜ì„¸ìš”. ì´ ${testUserData.gender} í•™ìƒì˜ ì²œê°„ì§€ì§€ ì¡°í•©ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì„±ê²©ì  íŠ¹ì§•ê³¼ í•™ì—… ì ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ìµœì ì˜ ê³ ë“±í•™êµ ìœ í˜•ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.`,
                
                `ì‚¬ì£¼ëª…ë¦¬í•™ì˜ ê´€ì ì—ì„œ ${testUserData.name}(${testUserData.gender}, ${testUserData.birthYear}/${testUserData.birthMonth}/${testUserData.birthDay} ${testUserData.birthTime})ì˜ ì˜¤í–‰ ê· í˜•ê³¼ ì‹­ì´ìš´ì„±ì„ ë¶„ì„í•˜ì—¬, ì´ í•™ìƒì´ 15-18ì„¸(ê³ ë“±í•™êµ ì‹œê¸°)ì— ì–´ë–¤ í•™ìŠµ í™˜ê²½ì—ì„œ ê°€ì¥ í° ì„±ì¥ì„ ì´ë£° ìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì¡°ì–¸í•˜ì„¸ìš”.`,
                
                `${testUserData.name} í•™ìƒì˜ ì‚¬ì£¼(${testUserData.birthYear}ë…„ ${testUserData.birthMonth}ì›” ${testUserData.birthDay}ì¼ ${testUserData.birthTime}, ${testUserData.gender})ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì¬ì„±, ê´€ì„±, ì¸ì„±, ì‹ìƒ, ë¹„ê²ì˜ ë°°ì¹˜ë¥¼ ì¢…í•© ë¶„ì„í•˜ì—¬, ì´ í•™ìƒì˜ ì§€ì  ëŠ¥ë ¥ ë°œë‹¬ íŒ¨í„´ê³¼ ì‚¬íšŒì„±ì„ ê³ ë ¤í•œ ì´ìƒì ì¸ ê³ êµ ì§„í•™ ì „ëµì„ ìˆ˜ë¦½í•˜ì„¸ìš”.`
            ];
            
            const basePrompt = specificPrompts[uniquePromptVariation - 1];
            
            const prompt = `${basePrompt}

ìš”ì²­ ID: ${requestId}
ë¶„ì„ ì‹œê°„: ${new Date().toISOString()}
í”„ë¡¬í”„íŠ¸ ë³€í˜•: ${uniquePromptVariation}

ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µë³€í•˜ê³ , ê° í•™ìƒì˜ ì‚¬ì£¼ íŠ¹ì„±ì— ë§ê²Œ êµ¬ì²´ì ì´ê³  ì°¨ë³„í™”ëœ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”:

{
  "requestId": "${requestId}",
  "analysisTime": "${new Date().toISOString()}",
  "promptVariation": ${uniquePromptVariation},
  "sajuElements": "ì´ í•™ìƒì˜ ì˜¤í–‰ê³¼ ì‹­ì‹  ë¶„ì„",
  "personality": "ì‚¬ì£¼ë¡œ ë³¸ ì„±ê²©ì  íŠ¹ì§• (êµ¬ì²´ì ìœ¼ë¡œ)",
  "learningStyle": "í•™ìŠµ ìŠ¤íƒ€ì¼ê³¼ ì§‘ì¤‘ë ¥ íŒ¨í„´",
  "socialTendency": "ì‚¬íšŒì„±ê³¼ ëŒ€ì¸ê´€ê³„ ì„±í–¥",
  "summary": "ì¢…í•©ì ì¸ ì‚¬ì£¼ íŠ¹ì„± ìš”ì•½",
  "recommendedSchools": [
    {"rank": 1, "type": "êµ¬ì²´ì ì¸ í•™êµ ìœ í˜•", "reason": "ì‚¬ì£¼ ë¶„ì„ì— ê¸°ë°˜í•œ ìƒì„¸í•œ ì¶”ì²œ ì´ìœ "},
    {"rank": 2, "type": "êµ¬ì²´ì ì¸ í•™êµ ìœ í˜•", "reason": "ì‚¬ì£¼ ë¶„ì„ì— ê¸°ë°˜í•œ ìƒì„¸í•œ ì¶”ì²œ ì´ìœ "},
    {"rank": 3, "type": "êµ¬ì²´ì ì¸ í•™êµ ìœ í˜•", "reason": "ì‚¬ì£¼ ë¶„ì„ì— ê¸°ë°˜í•œ ìƒì„¸í•œ ì¶”ì²œ ì´ìœ "}
  ],
  "notRecommendedSchools": [
    {"rank": 1, "type": "ë¶€ì í•©í•œ í•™êµ ìœ í˜•", "reason": "ì‚¬ì£¼ì ìœ¼ë¡œ ë§ì§€ ì•ŠëŠ” êµ¬ì²´ì  ì´ìœ "},
    {"rank": 2, "type": "ë¶€ì í•©í•œ í•™êµ ìœ í˜•", "reason": "ì‚¬ì£¼ì ìœ¼ë¡œ ë§ì§€ ì•ŠëŠ” êµ¬ì²´ì  ì´ìœ "}
  ],
  "studyTips": "ì´ í•™ìƒì˜ ì‚¬ì£¼ì— ë§ëŠ” í•™ìŠµë²• ì¡°ì–¸",
  "careerDirection": "ì¥ê¸°ì ì¸ ì§„ë¡œ ë°©í–¥ ì œì‹œ"
}

ê° í•­ëª©ë§ˆë‹¤ ì´ í•™ìƒë§Œì˜ ê³ ìœ í•œ ì‚¬ì£¼ì  íŠ¹ì„±ì„ ë°˜ì˜í•˜ì—¬ ì°¨ë³„í™”ëœ ë‚´ìš©ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”:`;
            
            try {
                log('ì‚¬ì£¼ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ê¸¸ì´: ' + prompt.length);
                log('API í˜¸ì¶œ ì‹œì‘...');
                
                const startTime = Date.now();
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.9,  // ë” ë†’ì€ creativity
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 3048,  // ë” ê¸´ ì‘ë‹µ í—ˆìš©
                        }
                    })
                });
                const endTime = Date.now();
                
                log(`ì‘ë‹µ ì‹œê°„: ${endTime - startTime}ms`);
                log(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`ì—ëŸ¬ ì‘ë‹µ: ${errorText}`, 'error');
                    setStatus(`ì‚¬ì£¼ API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`, 'error');
                    
                    // API í˜¸ì¶œ ì¶”ì  (ì‹¤íŒ¨)
                    trackApiCall('ì‚¬ì£¼ ë¶„ì„ API', false, endTime - startTime);
                    return;
                }
                
                const data = await response.json();
                log('ì‚¬ì£¼ API í˜¸ì¶œ ì„±ê³µ!', 'success');
                
                // API í˜¸ì¶œ ì¶”ì 
                trackApiCall('ì‚¬ì£¼ ë¶„ì„ API', true, endTime - startTime);
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const generatedText = data.candidates[0].content.parts[0].text;
                    log('ìƒì„±ëœ í…ìŠ¤íŠ¸ ê¸¸ì´: ' + generatedText.length);
                    
                    // JSON íŒŒì‹± ì‹œë„
                    try {
                        const cleanedText = generatedText
                            .replace(/```json\s*/g, '')
                            .replace(/```\s*/g, '')
                            .trim();
                        
                        const parsed = JSON.parse(cleanedText);
                        log('JSON íŒŒì‹± ì„±ê³µ!', 'success');
                        log(`ì‘ë‹µ ìš”ì²­ ID: ${parsed.requestId || 'ì—†ìŒ'}`);
                        log(`í”„ë¡¬í”„íŠ¸ ë³€í˜•: ${parsed.promptVariation || 'ì—†ìŒ'}`);
                        document.getElementById('result').textContent = JSON.stringify(parsed, null, 2);
                        setStatus('âœ… ì‚¬ì£¼ ë¶„ì„ API í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                    } catch (parseError) {
                        log(`JSON íŒŒì‹± ì‹¤íŒ¨: ${parseError.message}`, 'error');
                        log('ì›ë³¸ í…ìŠ¤íŠ¸: ' + generatedText);
                        document.getElementById('result').textContent = generatedText;
                        setStatus('âš ï¸ API ì„±ê³µí–ˆì§€ë§Œ JSON íŒŒì‹± ì‹¤íŒ¨', 'error');
                    }
                } else {
                    log('ì‘ë‹µì— candidatesê°€ ì—†ìŒ', 'error');
                    document.getElementById('result').textContent = JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                log(`ì‚¬ì£¼ API í˜¸ì¶œ ì˜¤ë¥˜: ${error.message}`, 'error');
                setStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                document.getElementById('result').textContent = error.stack;
                
                // API í˜¸ì¶œ ì¶”ì  (ì‹¤íŒ¨)
                trackApiCall('ì‚¬ì£¼ ë¶„ì„ API', false, Date.now() - startTime);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('í˜„ì¬ ì‹œê°„: ' + new Date().toISOString());
            log('ì‚¬ìš©ì ì—ì´ì „íŠ¸: ' + navigator.userAgent);
            log('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ' + (navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'));
        });
    </script>
</body>
</html> 