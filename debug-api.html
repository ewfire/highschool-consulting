<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í˜¸ì¶œ ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #000;
            color: #00ff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            height: 500px;
            overflow-y: auto;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #cce7ff; color: #004085; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” API í˜¸ì¶œ ë””ë²„ê¹…</h1>
        
        <button onclick="testSimpleAPI()">ê°„ë‹¨í•œ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="testFullSajuAPI()">ì „ì²´ ì‚¬ì£¼ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        
        <div id="status"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBY1aPCt5gkJr7m8BCuTRUjtLl5PWHO4Dg';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }
        
        async function testSimpleAPI() {
            log('=== ê°„ë‹¨í•œ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('API í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...', 'info');
            
            const requestBody = {
                contents: [{
                    parts: [{
                        text: 'ì•ˆë…•í•˜ì„¸ìš”! ê°„ë‹¨í•œ ì‘ë‹µì„ í•´ì£¼ì„¸ìš”.'
                    }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 100
                }
            };
            
            try {
                log('ğŸ“¤ ìš”ì²­ ì¤€ë¹„...');
                log(`URL: ${GEMINI_API_URL}?key=${GEMINI_API_KEY.slice(-4)}`);
                log(`ìš”ì²­ ë³¸ë¬¸: ${JSON.stringify(requestBody, null, 2)}`);
                
                const startTime = Date.now();
                log('ğŸŒ Fetch ìš”ì²­ ì‹œì‘...');
                
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const endTime = Date.now();
                log(`ğŸ“¥ ì‘ë‹µ ë°›ìŒ - ìƒíƒœ: ${response.status}, ì‹œê°„: ${endTime - startTime}ms`);
                
                // ì‘ë‹µ í—¤ë” í™•ì¸
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                log(`ğŸ“‹ ì‘ë‹µ í—¤ë”: ${JSON.stringify(headers, null, 2)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… API í˜¸ì¶œ ì„±ê³µ!', 'success');
                    log(`ğŸ“Š ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`);
                    setStatus('API í˜¸ì¶œ ì„±ê³µ!', 'success');
                } else {
                    const errorText = await response.text();
                    log(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨ - ìƒíƒœ: ${response.status}`, 'error');
                    log(`âŒ ì—ëŸ¬ ì‘ë‹µ: ${errorText}`, 'error');
                    setStatus(`API í˜¸ì¶œ ì‹¤íŒ¨ - ${response.status}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}`, 'error');
                log(`âŒ ì—ëŸ¬ ìŠ¤íƒ: ${error.stack}`, 'error');
                setStatus('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬', 'error');
            }
        }
        
        async function testFullSajuAPI() {
            log('=== ì „ì²´ ì‚¬ì£¼ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('ì‚¬ì£¼ API í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...', 'info');
            
            const requestId = Math.random().toString(36).substr(2, 16);
            const selectedPrompt = 'detailed';
            
            const basePrompt = `ì‚¬ì£¼íŒ”ì ë¶„ì„ ì „ë¬¸ê°€ë¡œì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³ ë“±í•™êµ ì¶”ì²œ ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.

**ë¶„ì„ ëŒ€ìƒ ì •ë³´:**
- ì´ë¦„: ê¹€ì² ìˆ˜
- ìƒë…„ì›”ì¼: 2008ë…„ 3ì›” 15ì¼
- ì¶œìƒì‹œê°„: ì˜¤ì‹œ
- ì„±ë³„: ë‚¨ì„±
- ìš”ì²­ ID: ${requestId}

**ë¶„ì„ ìš”êµ¬ì‚¬í•­:**
1. ì‚¬ì£¼ì˜¤í–‰ ë¶„ì„ì„ í†µí•œ ì„±ê²© ë° ì¬ëŠ¥ íŒŒì•…
2. ê³ ë“±í•™êµ 3ë…„ê°„ì˜ ìš´ì„¸ íë¦„ ì˜ˆì¸¡
3. ìµœì ì˜ ê³ ë“±í•™êµ ìœ í˜• 3ê°œ ì¶”ì²œ (êµ¬ì²´ì ì¸ ì´ìœ  í¬í•¨)
4. í”¼í•´ì•¼ í•  ê³ ë“±í•™êµ ìœ í˜• 2ê°œ (ì´ìœ  í¬í•¨)
5. í•™ìŠµ ë°©í–¥ ë° ì§„ë¡œ ì¡°ì–¸

**ì‘ë‹µ í˜•ì‹ (ë°˜ë“œì‹œ JSONìœ¼ë¡œë§Œ ì‘ë‹µ):**
{
  "requestId": "${requestId}",
  "promptVariation": "${selectedPrompt}",
  "sajuElements": "ì˜¤í–‰ ë¶„ì„ ë‚´ìš©",
  "personality": "ì„±ê²© ë¶„ì„",
  "learningStyle": "í•™ìŠµ ìŠ¤íƒ€ì¼",
  "socialTendency": "ì‚¬íšŒì  ì„±í–¥",
  "recommendedSchools": [
    {"rank": 1, "type": "í•™êµìœ í˜•1", "reason": "ì¶”ì²œ ì´ìœ "},
    {"rank": 2, "type": "í•™êµìœ í˜•2", "reason": "ì¶”ì²œ ì´ìœ "},
    {"rank": 3, "type": "í•™êµìœ í˜•3", "reason": "ì¶”ì²œ ì´ìœ "}
  ],
  "notRecommendedSchools": [
    {"rank": 1, "type": "í•™êµìœ í˜•1", "reason": "ë¹„ì¶”ì²œ ì´ìœ "},
    {"rank": 2, "type": "í•™êµìœ í˜•2", "reason": "ë¹„ì¶”ì²œ ì´ìœ "}
  ],
  "summary": "ì¢…í•©ì ì¸ ë¶„ì„ ìš”ì•½",
  "direction": {
    "bestDirection": "ë°©í–¥",
    "title": "ë°©í–¥ ì œëª©",
    "explanation": "ë°©í–¥ ì„¤ëª…"
  },
  "fortuneFlow": {
    "grade1": {"academic": 85, "social": 78, "health": 92},
    "grade2": {"academic": 88, "social": 82, "health": 85},
    "grade3": {"academic": 90, "social": 85, "health": 88}
  },
  "personalTraits": {
    "learningStyle": "í•™ìŠµ ìŠ¤íƒ€ì¼ ìƒì„¸",
    "socialTendency": "ì‚¬íšŒì  ì„±í–¥ ìƒì„¸",
    "specialTalent": "íŠ¹ë³„í•œ ì¬ëŠ¥",
    "cautions": "ì£¼ì˜ì‚¬í•­"
  },
  "studyTips": "êµ¬ì²´ì ì¸ ê³µë¶€ ë°©ë²• ì¡°ì–¸",
  "careerDirection": "ì§„ë¡œ ë°©í–¥ ì¡°ì–¸"
}`;
            
            const requestBody = {
                contents: [{
                    parts: [{
                        text: basePrompt
                    }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 4096,
                    stopSequences: [],
                    candidateCount: 1
                },
                safetySettings: [
                    {
                        category: "HARM_CATEGORY_HARASSMENT",
                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                    },
                    {
                        category: "HARM_CATEGORY_HATE_SPEECH", 
                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                    },
                    {
                        category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                    },
                    {
                        category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                    }
                ]
            };
            
            try {
                log('ğŸ“¤ ì‚¬ì£¼ ë¶„ì„ ìš”ì²­ ì¤€ë¹„...');
                log(`í”„ë¡¬í”„íŠ¸ ê¸¸ì´: ${basePrompt.length} ë¬¸ì`);
                log(`ìš”ì²­ ë³¸ë¬¸ í¬ê¸°: ${JSON.stringify(requestBody).length} bytes`);
                
                const startTime = Date.now();
                log('ğŸŒ Fetch ìš”ì²­ ì‹œì‘...');
                
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'HighSchool-Recommender/1.0'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const endTime = Date.now();
                log(`ğŸ“¥ ì‘ë‹µ ë°›ìŒ - ìƒíƒœ: ${response.status}, ì‹œê°„: ${endTime - startTime}ms`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… API í˜¸ì¶œ ì„±ê³µ!', 'success');
                    log(`ğŸ“Š ì „ì²´ ì‘ë‹µ: ${JSON.stringify(data, null, 2)}`);
                    
                    if (data.candidates && data.candidates.length > 0) {
                        const generatedText = data.candidates[0].content.parts[0].text;
                        log(`ğŸ“ ìƒì„±ëœ í…ìŠ¤íŠ¸: ${generatedText}`);
                        
                        // JSON íŒŒì‹± ì‹œë„
                        try {
                            let cleanedText = generatedText
                                .replace(/```json\s*/g, '')
                                .replace(/```\s*/g, '')
                                .replace(/^\s*[\`\'\"]*/g, '')
                                .replace(/[\`\'\\"]*\s*$/g, '')
                                .trim();
                            
                            const analysisResult = JSON.parse(cleanedText);
                            log('âœ… JSON íŒŒì‹± ì„±ê³µ!', 'success');
                            log(`ğŸ“Š íŒŒì‹±ëœ ê²°ê³¼: ${JSON.stringify(analysisResult, null, 2)}`);
                            setStatus('ì‚¬ì£¼ API í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                        } catch (parseError) {
                            log(`âŒ JSON íŒŒì‹± ì‹¤íŒ¨: ${parseError.message}`, 'error');
                            setStatus('JSON íŒŒì‹± ì‹¤íŒ¨', 'error');
                        }
                    }
                } else {
                    const errorText = await response.text();
                    log(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨ - ìƒíƒœ: ${response.status}`, 'error');
                    log(`âŒ ì—ëŸ¬ ì‘ë‹µ: ${errorText}`, 'error');
                    
                    // ì—ëŸ¬ ë°ì´í„° íŒŒì‹± ì‹œë„
                    try {
                        const errorData = JSON.parse(errorText);
                        log(`ğŸ“‹ íŒŒì‹±ëœ ì—ëŸ¬ ë°ì´í„°: ${JSON.stringify(errorData, null, 2)}`, 'error');
                        
                        // í• ë‹¹ëŸ‰ ì´ˆê³¼ í™•ì¸
                        if ((response.status === 429 || response.status === 403) && 
                            errorData.error && (
                                errorData.error.message.includes('quota') || 
                                errorData.error.message.includes('Quota') ||
                                errorData.error.message.includes('limit') ||
                                errorData.error.status === 'RESOURCE_EXHAUSTED' ||
                                errorData.error.status === 'QUOTA_EXCEEDED'
                            )) {
                            log('ğŸš¨ í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ê°ì§€!', 'error');
                            setStatus('í• ë‹¹ëŸ‰ ì´ˆê³¼!', 'error');
                        } else {
                            setStatus(`API ì—ëŸ¬ - ${response.status}`, 'error');
                        }
                    } catch (parseError) {
                        setStatus(`API í˜¸ì¶œ ì‹¤íŒ¨ - ${response.status}`, 'error');
                    }
                }
                
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}`, 'error');
                log(`âŒ ì—ëŸ¬ ìŠ¤íƒ: ${error.stack}`, 'error');
                setStatus('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬', 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í™˜ê²½ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', function() {
            log('ğŸš€ API ë””ë²„ê¹… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log(`ğŸŒ í˜„ì¬ URL: ${window.location.href}`);
            log(`ğŸ”’ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸: ${window.isSecureContext ? 'ì•ˆì „' : 'ë¹„ì•ˆì „'}`);
            log(`ğŸ“¡ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
            log(`ğŸ”‘ API í‚¤ ëìë¦¬: ${GEMINI_API_KEY.slice(-4)}`);
            log('ì¤€ë¹„ ì™„ë£Œ - í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”!');
        });
    </script>
</body>
</html> 