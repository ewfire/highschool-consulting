<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í˜¸ì¶œ ì§„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #3367d6;
        }
        .log {
            max-height: 400px;
            overflow-y: auto;
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” API í˜¸ì¶œ ì§„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
        
        <button onclick="testNetworkConnection()">ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testAPIKey()">API í‚¤ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸</button>
        <button onclick="testSimpleCall()">ê°„ë‹¨í•œ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸</button>
        <button onclick="checkConsoleErrors()">ì½˜ì†” ì˜¤ë¥˜ í™•ì¸</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        
        <div id="status"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyBY1aPCt5gkJr7m8BCuTRUjtLl5PWHO4Dg';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${typeIcon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }
        
        async function testNetworkConnection() {
            log('=== ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ ì¤‘...', 'info');
            
            try {
                // 1. ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
                log(`ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
                
                // 2. Google ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
                log('Google ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸...');
                const response = await fetch('https://www.google.com', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                log('âœ… Google ì„œë²„ ì ‘ê·¼ ê°€ëŠ¥');
                
                // 3. Gemini API ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
                log('Gemini API ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸...');
                const apiResponse = await fetch(GEMINI_API_URL, {
                    method: 'OPTIONS'
                });
                log(`Gemini API ì„œë²„ ì‘ë‹µ: ${apiResponse.status}`);
                
                setStatus('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì •ìƒ', 'success');
                
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
                setStatus('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨', 'error');
            }
        }
        
        async function testAPIKey() {
            log('=== API í‚¤ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('API í‚¤ í™•ì¸ ì¤‘...', 'info');
            
            try {
                log(`API í‚¤: ${GEMINI_API_KEY.substring(0, 10)}...${GEMINI_API_KEY.slice(-4)}`);
                log(`API í‚¤ ê¸¸ì´: ${GEMINI_API_KEY.length}`);
                
                // ë§¤ìš° ê°„ë‹¨í•œ ìš”ì²­ìœ¼ë¡œ API í‚¤ í…ŒìŠ¤íŠ¸
                const testRequest = {
                    contents: [{
                        parts: [{
                            text: 'Hello'
                        }]
                    }]
                };
                
                log('API í‚¤ ìœ íš¨ì„± í™•ì¸ ìš”ì²­ ì „ì†¡...');
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testRequest)
                });
                
                log(`ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                log(`ì‘ë‹µ ìƒíƒœ í…ìŠ¤íŠ¸: ${response.statusText}`);
                
                if (response.status === 200) {
                    log('âœ… API í‚¤ ìœ íš¨í•¨', 'success');
                    setStatus('API í‚¤ ìœ íš¨', 'success');
                } else if (response.status === 403) {
                    log('âŒ API í‚¤ ê¶Œí•œ ë¬¸ì œ ë˜ëŠ” í• ë‹¹ëŸ‰ ì´ˆê³¼', 'error');
                    setStatus('API í‚¤ ê¶Œí•œ ë¬¸ì œ', 'error');
                } else if (response.status === 400) {
                    log('âŒ ì˜ëª»ëœ ìš”ì²­ í˜•ì‹', 'error');
                    setStatus('ìš”ì²­ í˜•ì‹ ì˜¤ë¥˜', 'error');
                } else {
                    const errorText = await response.text();
                    log(`âŒ API í‚¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${errorText}`, 'error');
                    setStatus('API í‚¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'error');
                }
                
            } catch (error) {
                log(`âŒ API í‚¤ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                setStatus('API í‚¤ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜', 'error');
            }
        }
        
        async function testSimpleCall() {
            log('=== ê°„ë‹¨í•œ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            setStatus('API í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            try {
                const testRequest = {
                    contents: [{
                        parts: [{
                            text: 'ì•ˆë…•í•˜ì„¸ìš”. ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.'
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 100
                    }
                };
                
                log('í…ŒìŠ¤íŠ¸ ìš”ì²­ ì „ì†¡...');
                log(`ìš”ì²­ URL: ${GEMINI_API_URL}?key=${GEMINI_API_KEY.slice(-4)}`);
                log(`ìš”ì²­ ë³¸ë¬¸: ${JSON.stringify(testRequest, null, 2)}`);
                
                const startTime = Date.now();
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testRequest)
                });
                const endTime = Date.now();
                
                log(`ì‘ë‹µ ì‹œê°„: ${endTime - startTime}ms`);
                log(`ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… API í˜¸ì¶œ ì„±ê³µ!', 'success');
                    log(`ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`);
                    setStatus('API í˜¸ì¶œ ì„±ê³µ', 'success');
                } else {
                    const errorText = await response.text();
                    log(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨: ${errorText}`, 'error');
                    setStatus('API í˜¸ì¶œ ì‹¤íŒ¨', 'error');
                }
                
            } catch (error) {
                log(`âŒ API í˜¸ì¶œ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ì˜¤ë¥˜ ìŠ¤íƒ: ${error.stack}`);
                setStatus('API í˜¸ì¶œ ì˜¤ë¥˜', 'error');
            }
        }
        
        function checkConsoleErrors() {
            log('=== ì½˜ì†” ì˜¤ë¥˜ í™•ì¸ ===');
            
            // ê¸°ë³¸ ë¸Œë¼ìš°ì € ì •ë³´
            log(`ë¸Œë¼ìš°ì €: ${navigator.userAgent}`);
            log(`í˜„ì¬ URL: ${window.location.href}`);
            log(`í”„ë¡œí† ì½œ: ${window.location.protocol}`);
            
            // ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
            log(`ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸: ${window.isSecureContext ? 'ì•ˆì „' : 'ë¹„ì•ˆì „'}`);
            
            // ë¡œì»¬ íŒŒì¼ ì—¬ë¶€ í™•ì¸
            if (window.location.protocol === 'file:') {
                log('âš ï¸ ë¡œì»¬ íŒŒì¼ í”„ë¡œí† ì½œ ê°ì§€ - CORS ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
            }
            
            // ì˜¤ë¥˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            window.addEventListener('error', function(e) {
                log(`âŒ ì „ì—­ ì˜¤ë¥˜: ${e.error.message}`, 'error');
            });
            
            window.addEventListener('unhandledrejection', function(e) {
                log(`âŒ ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€: ${e.reason}`, 'error');
            });
            
            log('ì½˜ì†” ì˜¤ë¥˜ ëª¨ë‹ˆí„°ë§ ì‹œì‘...');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            log('ğŸš€ API ì§„ë‹¨ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ê° ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¨ê³„ë³„ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.');
        });
    </script>
</body>
</html> 